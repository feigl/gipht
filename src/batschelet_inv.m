function kappa=batschelet_inv(R)
% given R mean resultant length, return
% kappa concentration parameter in Von Mises distribution,
% from Mardia 1972 equation (5.4.5) page 122
%R = besseli(1,kappa)/besseli(0,kappa);
% Kurt Feigl
% 2008-MAR-18
%if 0 <= R & R <= 1.0
if 0 <= R && R < 0.99
%    if R < 0.5
%       guess = 0.2;
%    elseif R < 0.8;
%       guess = 2.0;
%     elseif R < 0.95;
%       guess = 8;  
%    else
%       guess = 16;
%    end
   %guess = R*2;
   % approxiimation from Fisher 1993, (3.47) page 51,
   % citing Best and Fisher, 1981
   if R < 0.53
      guess = 2*R + R^3 + 5*R^5/6;
   elseif 0.53 <= R && R < 0.85;
      guess = -0.4 + 1.39*R + 0.43 /(1-R);
   elseif R >= 0.85;
      guess = 1.0/(R^3 - 4*R^2 + 3*R);
   elseif R >= 0.98;
      guess = 50;
   elseif R >= 0.99;
      guess = 500;
   else
      guess = 16;
      warning 'unknown Rbar'
   end
   kappa = fzero(@(x)batschelet(x)-R,guess);
elseif 0.99 <= R & R <= 1.00
   warning(sprintf('Extreme Rbar %g\n',R));
   kappa = 700;
else
   warning(sprintf('undefined Rbar %g\n',R));
   kappa = NaN;
end

return




% % reproduce table of kappa as a function of Rbar
% % Appendix 2.3, page 2.98 of Mardia 1972
% 
% for Rbar = [0.01:0.01:0.99]
%    kappa = batschelet_inv(Rbar);
%    fprintf(1,'%8.2f %11.5f\n',Rbar,kappa);
% end
% 
% batschelet_inv_test
%     0.01     0.02000
%     0.02     0.04001
%     0.03     0.06003
%     0.04     0.08006
%     0.05     0.10013
%     0.06     0.12022
%     0.07     0.14034
%     0.08     0.16051
%     0.09     0.18073
%     0.10     0.20101
%     0.11     0.22134
%     0.12     0.24175
%     0.13     0.26223
%     0.14     0.28279
%     0.15     0.30344
%     0.16     0.32419
%     0.17     0.34503
%     0.18     0.36599
%     0.19     0.38707
%     0.20     0.40828
%     0.21     0.42962
%     0.22     0.45110
%     0.23     0.47273
%     0.24     0.49453
%     0.25     0.51649
%     0.26     0.53863
%     0.27     0.56097
%     0.28     0.58350
%     0.29     0.60625
%     0.30     0.62922
%     0.31     0.65242
%     0.32     0.67587
%     0.33     0.69958
%     0.34     0.72356
%     0.35     0.74783
%     0.36     0.77241
%     0.37     0.79730
%     0.38     0.82253
%     0.39     0.84812
%     0.40     0.87408
%     0.41     0.90043
%     0.42     0.92720
%     0.43     0.95440
%     0.44     0.98207
%     0.45     1.01022
%     0.46     1.03889
%     0.47     1.06810
%     0.48     1.09788
%     0.49     1.12828
%     0.50     1.15932
%     0.51     1.19105
%     0.52     1.22350
%     0.53     1.25672
%     0.54     1.29077
%     0.55     1.32570
%     0.56     1.36156
%     0.57     1.39842
%     0.58     1.43635
%     0.59     1.47543
%     0.60     1.51574
%     0.61     1.55738
%     0.62     1.60044
%     0.63     1.64506
%     0.64     1.69134
%     0.65     1.73945
%     0.66     1.78953
%     0.67     1.84177
%     0.68     1.89637
%     0.69     1.95357
%     0.70     2.01363
%     0.71     2.07685
%     0.72     2.14359
%     0.73     2.21425
%     0.74     2.28930
%     0.75     2.36930
%     0.76     2.45490
%     0.77     2.54686
%     0.78     2.64613
%     0.79     2.75382
%     0.80     2.87129
%     0.81     3.00020
%     0.82     3.14262
%     0.83     3.30114
%     0.84     3.47901
%     0.85     3.68041
%     0.86     3.91072
%     0.87     4.17703
%     0.88     4.48876
%     0.89     4.85871
%     0.90     5.30469
%     0.91     5.85223
%     0.92     6.53939
%     0.93     7.42572
%     0.94     8.61034
%     0.95    10.27169
%     0.96    12.76678
%     0.97    16.92887
%     0.98    25.25791
%     0.99    50.25385